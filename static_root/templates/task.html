<li class="li-task li-{{ attempts_info.best_attempt.status|get_lower_status }} {{ task_group.get_li_class }}" id="task-{{ task.id }}">
  <div class="task">
    <h4>{{ task.number }}.</h4>

    {% if task.task_type == 'default' %}
      <p class="max-points">
        (Максимум баллов: {{ task.get_points|minimize_digits }})
      </p>
      {% if task.image %}<img class="task-image" src="{{ task.image.url }}" width="{{ task.get_image_width }}"><br>{% endif %}
      {{ task.text }}<br>
      {% if attempts_info.best_attempt.status != 'Ok' %}
        {% if not attempts_info or mode == 'general' or attempts_info.get_n_attempts < task.get_max_attempts %}
          <form class="attempt-form" action="/send_attempt/{{ task.id }}/" method="post">
            {% csrf_token %}
            <input type="hidden" class="attempt-task-id" name="variable" value="{{ task.id }}">
            Попытка {{ attempts_info.get_n_attempts|get_new_attempt_number }}{% if mode == 'tournament' %}/{{ task.get_max_attempts }}{% endif %}:
            <div class="field-wrapper">
              {{ task.task_group.get_attempt_form.text }}
            </div>
            <input type="submit" value="Отправить на проверку" class="btn btn-custom-lg btn-lg btn-custom page-scroll">
            {% if mode == 'general' %}<input type="button" value="Посмотреть ответ" class="btn btn-custom-lg btn-lg btn-custom page-scroll show-answer">{% endif %}
          </form>
        {% else %}
          <b>Попытки закончились</b>
        {% endif %}
      {% else %}
      <form class="attempt-form">
        {% csrf_token %}
        <input type="hidden" class="attempt-task-id" name="variable" value="{{ task.id }}">
        <input type="button" value="Посмотреть ответ" class="btn btn-custom-lg btn-lg btn-custom page-scroll show-answer">
      </form>
      {% endif %}

      {% if attempts_info %}
        <div class="attempts">
          <ul class="list-rectangle">
            {% for attempt in attempts_info.attempts %}
              <li class="li-attempt li-{{ attempt.status|get_lower_status }}">
                {{ attempt.time|date:'H:i' }}:
                {% if attempt.status == 'Ok' %}
                  <b>{{ attempt.get_pretty_text }}</b>
                {% else %}
                  {{ attempt.get_pretty_text }}
                {% endif %}
                (баллы: {{ attempt.points|minimize_digits }}, статус: {{ attempt.status|get_ru_status }})
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

    {% elif task.task_type == 'wall' %}
      <div class="wall">
        <div class="wall-tiles">
          {% csrf_token %}
          <input type="hidden" class="attempt-task-id" name="variable" value="{{ task.id }}">
          {% for tile in task.get_wall|get_guessed_tiles:attempts_info %}
            <div class="wall-tile wall-tile-guessed wall-tile-guessed-{{ tile.category_id }}" id="task-{{ task.id }}-tile-{{ tile.id }}">
              <p>{{ tile.text }}</p>
            </div>
          {% endfor %}
          {% for tile in task.get_wall|get_not_guessed_tiles:attempts_info %}
            <div class="wall-tile wall-tile-not-guessed" id="task-{{ task.id }}-tile-{{ tile.id }}">
              <p>{{ tile.text }}</p>
            </div>
          {% endfor %}
        </div>
        <div class="wall-explanations">
          {% for exptile in task.get_wall|one_more:attempts_info|get_exptiles:mode %}
            <div class="wall-tile wall-tile-guessed-{{ tile.category_id }} wall-tile-explanation">
              {% if exptile.type == 'explanation_is_guessed' %}
                <p>OK</p>
              {% elif exptile.type == 'words_are_guessed' %}
                <form class="attempt-form wall-attempt-form" action="/send_attempt/{{ task.id }}/" method="post">
                  {% csrf_token %}
                  <input type="hidden" class="attempt-task-id" name="task_id" value="{{ task.id }}">
                  <input type="hidden" name="words" value="{{ exptile.words|json_encode }}">
                  <input type="hidden" name="stage" value="cat_explanation">
                  Попытка: {{ exptile.explanation_n_attempts|get_new_attempt_number }} / {{ exptile.explanation_max_attempts }}:
                  <div class="field-wrapper wall-field-wrapper">
                    {{ task.task_group.get_attempt_form.text }}
                  </div>
                  <input type="submit" value="Отправить на проверку" class="btn btn-custom-sm btn-sm btn-custom page-scroll">
                </form>
              {% elif exptile.type == 'first_nothing_is_guessed' %}
                <p>Попытка угадать набор слов: {{ exptile.words_n_attempts|get_new_attempt_number }} / {{ exptile.words_max_attempts }}</p>
              {% elif exptile.type == 'nothing_is_guessed' %}
                <p>Число попыток после {{ exptile.id }} OK: {{ exptile.words_max_attempts }}</p>
              {% elif exptile.type == 'no_more_guesses' %}
                <p>Попытки закончились.</p>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>

      {% if mode == 'general' or attempts_info.best_attempt.status == 'Ok' %}
        <form class="attempt-form">
          {% csrf_token %}
          <input type="hidden" class="attempt-task-id" name="variable" value="{{ task.id }}">
          <input type="button" value="Посмотреть ответ" class="btn btn-custom-lg btn-lg btn-custom page-scroll show-answer">
        </form>
      {% endif %}

      <p class="max-points">
        (Один угаданный набор слов стоит: {{ task.get_wall.points_words|minimize_digits }})<br>
        (Одно угаданное объяснение стоит: {{ task.get_wall.points_explanation|minimize_digits }})<br>
        (Бонус за полное угадывание: {{ task.get_wall.points_bonus|minimize_digits }})<br>
        (Максимум баллов: {{ task.get_wall.max_points|minimize_digits }})<br>
      </p>

      {% if attempts_info %}
        <div class="attempts">
          <ul class="list-rectangle">
            {% for attempt in attempts_info.attempts %}
              <li class="li-attempt li-{{ attempt|get_wall_attempt_status|get_lower_status }}">
                {{ attempt.time|date:'H:i' }}:
                {% if attempt.status == 'Ok' %}
                  <b>{{ attempt.get_pretty_text }}</b>
                {% else %}
                  {{ attempt.get_pretty_text }}
                {% endif %}
                (баллы: {{ attempt.points|minimize_digits }} {% if attempt|get_wall_attempt_points > 0 %}(+{{ attempt|get_wall_attempt_points|minimize_digits }}){% endif %},
                статус: {{ attempt|get_wall_attempt_status|get_ru_status }})
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

    {% endif %}
  </div>
</li>